---
title: "import_tidy_join"
author: "Connor Flynn"
date: "6/30/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(here)
library(readxl)
library(xlsx)
library(ClustImpute)
library(tidyverse)
library(cluster)
library(factoextra)
library(gridExtra)
options(scipen = 99)
```

Goal 1


Import data
```{r}
goal1 <- read_csv(here("data/sdg_data/Goal1.csv"))

```

Convert Value Column to class numeric
```{r}
goal1 <- goal1 %>% 
  mutate(Value = as.numeric(Value))
```


Group in order to get median value form multiple years/categories of data
```{r}

goal1_tidy_grouped <- goal1 %>% 
  group_by(SeriesDescription, GeoAreaName) %>% 
  summarise(MedianValue = median(Value))
```


```{r}
goal1_wider <- goal1_tidy_grouped %>% 
  pivot_wider(names_from = SeriesDescription,
              values_from = MedianValue)
```


Goal 2


Import data
```{r}
goal2 <- read_csv(here("data/sdg_data/Goal2.csv"))

```

Convert Value Column to class numeric
```{r}
goal2 <- goal2 %>% 
  mutate(Value = as.numeric(Value))
```


Group in order to get median value form multiple years/categories of data
```{r}
goal2_tidy_grouped <- goal2 %>% 
  group_by(SeriesDescription, GeoAreaName) %>% 
  summarise(MedianValue = median(Value))
```


```{r}
goal2_wider <- goal2_tidy_grouped %>% 
  pivot_wider(names_from = SeriesDescription,
              values_from = MedianValue)

goal2_wider <- goal2_wider  %>% 
  filter(GeoAreaName != "Bonaire, Sint Eustatius and Saba")
```


```{r}
goals_1_2_joined <- full_join(goal1_wider, goal2_wider, by = "GeoAreaName")
```

Goal 3 

Import data
```{r}
goal3 <- read_csv(here("data/sdg_data/Goal3.csv"))

```

Convert Value Column to class numeric
```{r}
goal3 <- goal3 %>% 
  mutate(Value = as.numeric(Value))
```


Group in order to get median value form multiple years/categories of data
```{r}

goal3_tidy_grouped <- goal3 %>% 
  group_by(SeriesDescription, GeoAreaName) %>% 
  summarise(MedianValue = median(Value))
```


```{r}
goal3_wider <- goal3_tidy_grouped %>% 
  pivot_wider(names_from = SeriesDescription,
              values_from = MedianValue)
```


```{r}
goals_1_2_3_joined <- full_join(goals_1_2_joined, goal3_wider, by = "GeoAreaName")
```


Goal 4

Import data
```{r}
goal4 <- read_csv(here("data/sdg_data/Goal4.csv"))

```

Convert Value Column to class numeric
```{r}
goal4 <- goal4 %>% 
  mutate(Value = as.numeric(Value))
```


Group in order to get median value form multiple years/categories of data
```{r}

goal4_tidy_grouped <- goal4 %>% 
  group_by(SeriesDescription, GeoAreaName) %>% 
  summarise(MedianValue = median(Value))
```


```{r}
goal4_wider <- goal4_tidy_grouped %>% 
  pivot_wider(names_from = SeriesDescription,
              values_from = MedianValue) 

goal4_wider <- goal4_wider %>% 
    filter(GeoAreaName != "Bonaire, Sint Eustatius and Saba")
```


```{r}
goals_1_2_3_4_joined <- full_join(goals_1_2_3_joined, goal4_wider, by = "GeoAreaName")
```


Goal 5

Import data
```{r}
goal5 <- read_csv(here("data/sdg_data/Goal5.csv"))

```

Convert Value Column to class numeric
```{r}
goal5 <- goal5 %>% 
  mutate(Value = as.numeric(Value))
```


Group in order to get median value form multiple years/categories of data
```{r}

goal5_tidy_grouped <- goal5 %>% 
  group_by(SeriesDescription, GeoAreaName) %>% 
  summarise(MedianValue = median(Value))
```


```{r}
goal5_wider <- goal5_tidy_grouped %>% 
  pivot_wider(names_from = SeriesDescription,
              values_from = MedianValue)

goal5_wider <- goal5_wider %>% 
    filter(GeoAreaName != "Bonaire, Sint Eustatius and Saba")
```


```{r}
goals_1_2_3_4_5_joined <- full_join(goals_1_2_3_4_joined, goal5_wider, by = "GeoAreaName")
```


Goal 6

Import data
```{r}
goal6 <- read_csv(here("data/sdg_data/Goal6.csv"))

```

Convert Value Column to class numeric
```{r}
goal6 <- goal6 %>% 
  mutate(Value = as.numeric(Value))
```


Group in order to get median value form multiple years/categories of data
```{r}

goal6_tidy_grouped <- goal6 %>% 
  group_by(SeriesDescription, GeoAreaName) %>% 
  summarise(MedianValue = median(Value))
```


```{r}
goal6_wider <- goal6_tidy_grouped %>% 
  pivot_wider(names_from = SeriesDescription,
              values_from = MedianValue)

goal6_wider <- goal6_wider %>% 
    filter(GeoAreaName != "Bonaire, Sint Eustatius and Saba")
```


```{r}
goals_1_2_3_4_5_6_joined <- full_join(goals_1_2_3_4_5_joined, goal6_wider, by = "GeoAreaName")
```


Goal 7

Import data
```{r}
goal7 <- read_csv(here("data/sdg_data/Goal7.csv"))

```

Convert Value Column to class numeric
```{r}
goal7 <- goal7 %>% 
  mutate(Value = as.numeric(Value))
```


Group in order to get median value form multiple years/categories of data
```{r}

goal7_tidy_grouped <- goal7 %>% 
  group_by(SeriesDescription, GeoAreaName) %>% 
  summarise(MedianValue = median(Value))
```


```{r}
goal7_wider <- goal7_tidy_grouped %>% 
  pivot_wider(names_from = SeriesDescription,
              values_from = MedianValue)

goal7_wider <- goal7_wider %>% 
    filter(GeoAreaName != "Bonaire, Sint Eustatius and Saba")
```


```{r}
goals_1_2_3_4_5_6_7_joined <- full_join(goals_1_2_3_4_5_6_joined, goal7_wider, by = "GeoAreaName")
```


Goal 8 

Import data
```{r}
goal8 <- read_csv(here("data/sdg_data/Goal8.csv"))

```

Convert Value Column to class numeric
```{r}
goal8 <- goal8 %>% 
  mutate(Value = as.numeric(Value))
```


Group in order to get median value form multiple years/categories of data
```{r}

goal8_tidy_grouped <- goal8 %>% 
  group_by(SeriesDescription, GeoAreaName) %>% 
  summarise(MedianValue = median(Value))
```


```{r}
goal8_wider <- goal8_tidy_grouped %>% 
  pivot_wider(names_from = SeriesDescription,
              values_from = MedianValue)
```


```{r}
goals_1_2_3_4_5_6_7_8_joined <- full_join(goals_1_2_3_4_5_6_7_joined, goal8_wider, by = "GeoAreaName")
```



Goal 9

Import data
```{r}
goal9 <- read_csv(here("data/sdg_data/Goal9.csv"))

```

Convert Value Column to class numeric
```{r}
goal9 <- goal9 %>% 
  mutate(Value = as.numeric(Value))
```


Group in order to get median value form multiple years/categories of data
```{r}

goal9_tidy_grouped <- goal9 %>% 
  group_by(SeriesDescription, GeoAreaName) %>% 
  summarise(MedianValue = median(Value))
```


```{r}
goal9_wider <- goal9_tidy_grouped %>% 
  pivot_wider(names_from = SeriesDescription,
              values_from = MedianValue)

goal9_wider <- goal9_wider %>% 
    filter(GeoAreaName != "Bonaire, Sint Eustatius and Saba")
```


```{r}
goals_1_2_3_4_5_6_7_8_9_joined <- full_join(goals_1_2_3_4_5_6_7_8_joined, goal9_wider, by = "GeoAreaName")
```


Goal 10

Import data
```{r}
goal10 <- read_csv(here("data/sdg_data/Goal10.csv"))

```

Convert Value Column to class numeric
```{r}
goal10 <- goal10 %>% 
  mutate(Value = as.numeric(Value))
```


Group in order to get median value form multiple years/categories of data
```{r}

goal10_tidy_grouped <- goal10 %>% 
  group_by(SeriesDescription, GeoAreaName) %>% 
  summarise(MedianValue = median(Value))
```


```{r}
goal10_wider <- goal10_tidy_grouped %>% 
  pivot_wider(names_from = SeriesDescription,
              values_from = MedianValue)

goal10_wider <- goal10_wider %>% 
    filter(GeoAreaName != "Bonaire, Sint Eustatius and Saba")
```


```{r}
goals_1_2_3_4_5_6_7_8_9_10_joined <- full_join(goals_1_2_3_4_5_6_7_8_9_joined, goal10_wider, by = "GeoAreaName")
```

Removing NA's

```{r}
sdg_1_10 <- goals_1_2_3_4_5_6_7_8_9_10_joined

sdg_1_10 <- sdg_1_10 %>%
  filter(#GeoAreaName != "Singapore",
         GeoAreaName != "Small island developing States (SIDS)")
```


```{r}
sdg_1_10_less_na <- sdg_1_10[, which(colMeans(!is.na(sdg_1_10)) > 0.1)]
```


ClustImpute

```{r}
sdg_1_10_less_na <- sdg_1_10_less_na %>% 
  remove_rownames %>% 
  column_to_rownames(var="GeoAreaName")



```


```{r}
 
nums <- unlist(lapply(sdg_1_10, is.numeric), use.names = FALSE)
```


```{r}
res <- ClustImpute(sdg_1_10_less_na, nr_cluster = 3)
```


```{r}
res_centroids <- res$centroids

res_complete_data <- scale(res$complete_data)



```

```{r}
fviz_nbclust(res_complete_data, kmeans, method = "wss")
```


```{r}
set.seed(123)
kmeans2 <- kmeans(res_complete_data, center = 6, nstart = 100)
```





```{r}
fviz_cluster(kmeans2, data = res_complete_data)
```
```{r}
# from https://www.datanovia.com/en/blog/k-means-clustering-visualization-in-r-step-by-step-guide/#:~:text=The%20function%20fviz_cluster()%20%5Bfactoextra,variables%20is%20greater%20than%202.

# Dimension reduction using PCA
res.pca <- prcomp(res_complete_data[, -5],  scale = TRUE)
# Coordinates of individuals
ind.coord <- as.data.frame(get_pca_ind(res.pca)$coord)
# Add clusters obtained using the K-means algorithm
ind.coord$cluster <- factor(res$cluster)
# # Add Species groups from the original data sett
# ind.coord$Species <- df$Species
# Data inspection
head(ind.coord)
```

```{r}
eigenvalue <- round(get_eigenvalue(res.pca), 1)
variance.percent <- eigenvalue$variance.percent
head(eigenvalue)
```



Back to Joining 

Goal 11


Import data
```{r}
goal11 <- read_csv(here("data/sdg_data/Goal11.csv"))

```

Convert Value Column to class numeric
```{r}
goal11 <- goal11 %>% 
  mutate(Value = as.numeric(Value))
```


Group in order to get median value form multiple years/categories of data
```{r}

goal11_tidy_grouped <- goal11 %>% 
  group_by(SeriesDescription, GeoAreaName) %>% 
  summarise(MedianValue = median(Value))
```


```{r}
goal11_wider <- goal11_tidy_grouped %>% 
  pivot_wider(names_from = SeriesDescription,
              values_from = MedianValue)

goal11_wider <- goal11_wider %>% 
    filter(GeoAreaName != "Bonaire, Sint Eustatius and Saba")
```

```{r}
sdg_1_11_joined <- full_join(sdg_1_10, goal11_wider, by = "GeoAreaName")
```



Goal 12 

Import data
```{r}
goal12 <- read_csv(here("data/sdg_data/Goal12.csv"))

```

Convert Value Column to class numeric
```{r}
goal12 <- goal12 %>% 
  mutate(Value = as.numeric(Value))
```


Group in order to get median value form multiple years/categories of data
```{r}

goal12_tidy_grouped <- goal12 %>% 
  group_by(SeriesDescription, GeoAreaName) %>% 
  summarise(MedianValue = median(Value))
```


```{r}
goal12_wider <- goal12_tidy_grouped %>% 
  pivot_wider(names_from = SeriesDescription,
              values_from = MedianValue)

goal12_wider <- goal12_wider %>% 
    filter(GeoAreaName != "Bonaire, Sint Eustatius and Saba",
           GeoAreaName != "Small island developing States (SIDS)")
```

```{r}
sdg_1_12_joined <- full_join(sdg_1_11_joined, goal12_wider, by = "GeoAreaName" )
```




Goal 13

Import data
```{r}
goal13 <- read_csv(here("data/sdg_data/Goal13.csv"))

```

Convert Value Column to class numeric
```{r}
goal13 <- goal13 %>% 
  mutate(Value = as.numeric(Value))
```


Group in order to get median value form multiple years/categories of data
```{r}

goal13_tidy_grouped <- goal13 %>% 
  group_by(SeriesDescription, GeoAreaName) %>% 
  summarise(MedianValue = median(Value))
```


```{r}
goal13_wider <- goal13_tidy_grouped %>% 
  pivot_wider(names_from = SeriesDescription,
              values_from = MedianValue)

goal13_wider <- goal13_wider %>% 
    filter(GeoAreaName != "Bonaire, Sint Eustatius and Saba",
           GeoAreaName != "Small island developing States (SIDS)")
```

```{r}
sdg_1_13_joined <- full_join(sdg_1_12_joined, goal13_wider, by = "GeoAreaName")
```



Goal 14

Import data
```{r}
goal14 <- read_csv(here("data/sdg_data/Goal14.csv"))

```

Convert Value Column to class numeric
```{r}
goal14 <- goal14 %>% 
  mutate(Value = as.numeric(Value))
```


Group in order to get median value form multiple years/categories of data
```{r}

goal14_tidy_grouped <- goal14 %>% 
  group_by(SeriesDescription, GeoAreaName) %>% 
  summarise(MedianValue = median(Value))
```


```{r}
goal14_wider <- goal14_tidy_grouped %>% 
  pivot_wider(names_from = SeriesDescription,
              values_from = MedianValue)

goal14_wider <- goal14_wider %>% 
    filter(GeoAreaName != "Bonaire, Sint Eustatius and Saba",
           GeoAreaName != "Small island developing States (SIDS)")
```

```{r}
sdg_1_14_joined <- full_join(sdg_1_13_joined, goal14_wider, by = "GeoAreaName")
```



Goal 15 

Import data
```{r}
goal15 <- read_csv(here("data/sdg_data/Goal15.csv"))

```

Convert Value Column to class numeric
```{r}
goal15 <- goal15 %>% 
  mutate(Value = as.numeric(Value))
```


Group in order to get median value form multiple years/categories of data
```{r}

goal15_tidy_grouped <- goal15 %>% 
  group_by(SeriesDescription, GeoAreaName) %>% 
  summarise(MedianValue = median(Value))
```


```{r}
goal15_wider <- goal15_tidy_grouped %>% 
  pivot_wider(names_from = SeriesDescription,
              values_from = MedianValue)

goal15_wider <- goal15_wider %>% 
    filter(GeoAreaName != "Bonaire, Sint Eustatius and Saba",
           GeoAreaName != "Small island developing States (SIDS)")
```

```{r}
sdg_1_15_joined <- full_join(sdg_1_14_joined, goal15_wider, by = "GeoAreaName")
```


Goal 16 

Import data
```{r}
goal16 <- read_csv(here("data/sdg_data/Goal16.csv"))

```

Convert Value Column to class numeric
```{r}
goal16 <- goal16 %>% 
  mutate(Value = as.numeric(Value))
```


Group in order to get median value form multiple years/categories of data
```{r}

goal16_tidy_grouped <- goal16 %>% 
  group_by(SeriesDescription, GeoAreaName) %>% 
  summarise(MedianValue = median(Value))
```


```{r}
goal16_wider <- goal16_tidy_grouped %>% 
  pivot_wider(names_from = SeriesDescription,
              values_from = MedianValue)

goal16_wider <- goal16_wider %>% 
    filter(GeoAreaName != "Bonaire, Sint Eustatius and Saba",
           GeoAreaName != "Small island developing States (SIDS)")
```

```{r}
sdg_1_16_joined <- full_join(sdg_1_15_joined, goal16_wider, by = "GeoAreaName")
```



Goal 17 


Import data
```{r}
goal17 <- read_csv(here("data/sdg_data/Goal17.csv"))

```

Convert Value Column to class numeric
```{r}
goal17 <- goal17 %>% 
  mutate(Value = as.numeric(Value))
```


Group in order to get median value form multiple years/categories of data
```{r}

goal17_tidy_grouped <- goal17 %>% 
  group_by(SeriesDescription, GeoAreaName) %>% 
  summarise(MedianValue = median(Value))
```


```{r}
goal17_wider <- goal17_tidy_grouped %>% 
  pivot_wider(names_from = SeriesDescription,
              values_from = MedianValue)

goal17_wider <- goal17_wider %>% 
    filter(GeoAreaName != "Bonaire, Sint Eustatius and Saba",
           GeoAreaName != "Small island developing States (SIDS)")
```

```{r}
sdg_1_17_joined <- full_join(sdg_1_16_joined, goal17_wider, by = "GeoAreaName")
```

***Check for duplicates

```{r}
sdg_1_17_joined_duplicate_check <- sdg_1_17_joined[!duplicated(as.list(sdg_1_17_joined))]
```

Correlation matrix 

```{r}
mis_ind <- is.na(sdg_1_17_joined) # missing indicator
corrplot(cor(mis_ind),method="number")
```


Write CSV

```{r}
write_csv(sdg_1_17_joined, (here("data/sdg_data/sdg_indicators.csv")))
```

